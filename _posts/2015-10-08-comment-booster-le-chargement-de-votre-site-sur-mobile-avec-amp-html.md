---
id: 321
title: Comment Booster le chargement de votre site sur mobile avec AMP HTML
date: 2015-10-08T10:59:51+02:00
author: charlesen
layout: post
guid: https://charlesen.fr/?p=321
permalink: /comment-booster-le-chargement-de-votre-site-sur-mobile-avec-amp-html/
image: /wp-content/uploads/2015/10/images_blog_site-mobile-charlesen.png
categories:
  - tutoriel
---
Dans un [article précédent](index.php?option=com_content&view=article&id=169:google-lance-le-projet-amp&catid=36&Itemid=55), je vous parlais du Projet AMP lancé par Google dans le but d&rsquo;accélerer la consultation de contenus en ligne depuis un appareil mobile (smartphone, tablette,&#8230;). La librairie AMP HTML permet d&rsquo;implémenter les spécifications du projet grâce l&rsquo;intégration d&rsquo;un fichier Javascript et l&rsquo;insertion d&rsquo;un certain nombre de metadonnées.

<!--more-->

&nbsp;

### Comment ça marche

AMP HTML fonctionne par insertion de sa librairie Javascritp et en suivant une certaine mise en page HTML

<pre style="overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; color: #333333; background-color: #f7f7f7;">&lt;!doctype html&gt; &lt;<span class="pl-ent" style="color: #63a35c;">html</span> ⚡&gt;   &lt;<span class="pl-ent" style="color: #63a35c;">head</span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">meta</span> <span class="pl-e" style="color: #795da3;">charset</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">link</span> <span class="pl-e" style="color: #795da3;">rel</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>canonical<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">href</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>hello-world.html<span class="pl-pds">"</span></span> &gt;     &lt;<span class="pl-ent" style="color: #63a35c;">meta</span> <span class="pl-e" style="color: #795da3;">name</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>viewport<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">content</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>width=device-width,minimum-scale=1,initial-scale=1<span class="pl-pds">"</span></span>&gt; <span class="pl-s1">    &lt;<span class="pl-ent" style="color: #63a35c;">style</span>&gt;<span class="pl-ent" style="color: #63a35c;">body</span> {<span class="pl-c1" style="color: #0086b3;"><span class="pl-c1">opacity</span></span>: <span class="pl-c1" style="color: #0086b3;"></span>}&lt;/<span class="pl-ent" style="color: #63a35c;">style</span>&gt;</span>&lt;<span class="pl-ent" style="color: #63a35c;">noscript</span>&gt;<span class="pl-s1">&lt;<span class="pl-ent" style="color: #63a35c;">style</span>&gt;<span class="pl-ent" style="color: #63a35c;">body</span> {<span class="pl-c1" style="color: #0086b3;"><span class="pl-c1">opacity</span></span>: <span class="pl-c1" style="color: #0086b3;">1</span>}&lt;/<span class="pl-ent" style="color: #63a35c;">style</span>&gt;</span>&lt;/<span class="pl-ent" style="color: #63a35c;">noscript</span>&gt; <span class="pl-s1">    &lt;<span class="pl-ent" style="color: #63a35c;">script</span> <span class="pl-e" style="color: #795da3;">async</span> <span class="pl-e" style="color: #795da3;">src</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>https://cdn.ampproject.org/v0.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent" style="color: #63a35c;">script</span>&gt;</span>   &lt;/<span class="pl-ent" style="color: #63a35c;">head</span>&gt;   &lt;<span class="pl-ent" style="color: #63a35c;">body</span>&gt;Hello World!&lt;/<span class="pl-ent" style="color: #63a35c;">body</span>&gt; &lt;/<span class="pl-ent" style="color: #63a35c;">html</span>&gt;</pre>

Ce bout de code permet le chargement de ressources qui accelereront la page. Les tags obligatoires à une utilisation optimale du Framework sont les suivants :

  1. Le doctype HTML 5 : <!doctype html>
  2. L&rsquo;attribut <span style="color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; line-height: 21.76px; background-color: rgba(0, 0, 0, 0.0392157);">⚡ </span>ou simplement **amp** dans le tag html (<html amp>)
  3. Les tags **head** et **body**. Ceux-ci sont en effet optionnels en HTML (non ce n&rsquo;est pas du laxisme, juste question de perf&#8230;)
  4. Un lien canonique : <link rel= »canonical » href= »$UNE_URL » />
  5. L&rsquo;encodage utf-8 : <meta charset= »utf-8&Prime;>
  6. Le viewport : <meta name= »viewport » content= »width=device-width,minimum-scale=1&Prime;>
  7. La librairie JS : <script async src= »https://cdn.ampproject.org/v0.js »></script>

L&rsquo;exemple était plutôt basique, mais dans la vraie vie, un site contient des images, des vidéos,&#8230;AMP propose différents composants qui vont nous permettre d&rsquo;inclure ces différents élements.

### Inclure des images

<pre style="overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; color: #333333; background-color: #f7f7f7;">&lt;!doctype html&gt; &lt;<span class="pl-ent" style="color: #63a35c;">html</span> <span class="pl-e" style="color: #795da3;">AMP</span> <span class="pl-e" style="color: #795da3;">lang</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>en<span class="pl-pds">"</span></span>&gt;   &lt;<span class="pl-ent" style="color: #63a35c;">head</span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">meta</span> <span class="pl-e" style="color: #795da3;">charset</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">title</span>&gt;Hello, AMPs&lt;/<span class="pl-ent" style="color: #63a35c;">title</span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">link</span> <span class="pl-e" style="color: #795da3;">rel</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>canonical<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">href</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>https://charlesen.fr/comment-booster-le-chargement-de-votre-site-sur-mobile-avec-amp-html.html<span class="pl-pds">"</span></span> /&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">meta</span> <span class="pl-e" style="color: #795da3;">name</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>viewport<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">content</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>width=device-width,minimum-scale=1,initial-scale=1<span class="pl-pds">"</span></span>&gt; <span class="pl-s1">    &lt;<span class="pl-ent" style="color: #63a35c;">script</span> <span class="pl-e" style="color: #795da3;">type</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>application/ld+json<span class="pl-pds">"</span></span>&gt;</span> <span class="pl-s1">      {</span> <span class="pl-s1">        <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>@context<span class="pl-pds">"</span></span><span class="pl-k" style="color: #a71d5d;">:</span> <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>http://schema.org<span class="pl-pds">"</span></span>,</span> <span class="pl-s1">        <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>@type<span class="pl-pds">"</span></span><span class="pl-k" style="color: #a71d5d;">:</span> <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>NewsArticle<span class="pl-pds">"</span></span>,</span> <span class="pl-s1">        <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>headline<span class="pl-pds">"</span></span><span class="pl-k" style="color: #a71d5d;">:</span> <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>Une page avec des images<span class="pl-pds">"</span></span>,</span> <span class="pl-s1">        <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>datePublished<span class="pl-pds">"</span></span><span class="pl-k" style="color: #a71d5d;">:</span> <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>2015-10-07T12:02:41Z<span class="pl-pds">"</span></span>,</span> <span class="pl-s1">        <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>image<span class="pl-pds">"</span></span><span class="pl-k" style="color: #a71d5d;">:</span> [</span> <span class="pl-s1">          <span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>logo.jpg<span class="pl-pds">"</span></span></span> <span class="pl-s1">        ]</span> <span class="pl-s1">      }</span> <span class="pl-s1">    &lt;/<span class="pl-ent" style="color: #63a35c;">script</span>&gt;</span> <span class="pl-s1">    &lt;<span class="pl-ent" style="color: #63a35c;">style</span>&gt;<span class="pl-ent" style="color: #63a35c;">body</span> {<span class="pl-c1" style="color: #0086b3;"><span class="pl-c1">opacity</span></span>: <span class="pl-c1" style="color: #0086b3;"></span>}&lt;/<span class="pl-ent" style="color: #63a35c;">style</span>&gt;</span>&lt;<span class="pl-ent" style="color: #63a35c;">noscript</span>&gt;<span class="pl-s1">&lt;<span class="pl-ent" style="color: #63a35c;">style</span>&gt;<span class="pl-ent" style="color: #63a35c;">body</span> {<span class="pl-c1" style="color: #0086b3;"><span class="pl-c1">opacity</span></span>: <span class="pl-c1" style="color: #0086b3;">1</span>}&lt;/<span class="pl-ent" style="color: #63a35c;">style</span>&gt;</span>&lt;/<span class="pl-ent" style="color: #63a35c;">noscript</span>&gt; <span class="pl-s1">    &lt;<span class="pl-ent" style="color: #63a35c;">script</span> <span class="pl-e" style="color: #795da3;">async</span> <span class="pl-e" style="color: #795da3;">src</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>https://cdn.ampproject.org/v0.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent" style="color: #63a35c;">script</span>&gt;</span>   &lt;/<span class="pl-ent" style="color: #63a35c;">head</span>&gt;   &lt;<span class="pl-ent" style="color: #63a35c;">body</span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">h1</span>&gt;Une page plus élaborée&lt;/<span class="pl-ent" style="color: #63a35c;">h1</span>&gt;     &lt;<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-img</span> <span class="pl-e" style="color: #795da3;">src</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>welcome.jpg<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">alt</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>Welcome<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">height</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">width</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>800<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-img</span>&gt;   &lt;/<span class="pl-ent" style="color: #63a35c;">body</span>&gt; &lt;/<span class="pl-ent" style="color: #63a35c;">html</span>&gt;</pre>

Les attributs recommandés sont :

  * Les dimensions (largeur-width et hauteur &#8211; height)
  * Un text alternatif au cas votre image mettrait longtemps à se charger (réseaux,&#8230;)

&nbsp;

### Inclure des vidéos

<pre style="overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; color: #333333; background-color: #f7f7f7;">&lt;<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-video</span> <span class="pl-e" style="color: #795da3;">width</span>=<span class="pl-s" style="color: #183691;">400</span> <span class="pl-e" style="color: #795da3;">height</span>=<span class="pl-s" style="color: #183691;">300</span> <span class="pl-e" style="color: #795da3;">src</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>https://votresite.com/videos/unevideo.mp4<span class="pl-pds">"</span></span>     <span class="pl-e" style="color: #795da3;">poster</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"unevideo</span>-image-preview.jpg<span class="pl-pds">"</span></span>&gt;   &lt;<span class="pl-ent" style="color: #63a35c;">div</span> <span class="pl-e" style="color: #795da3;">fallback</span>&gt;         &lt;<span class="pl-ent" style="color: #63a35c;">p</span>&gt;Votre navigateur ne supporte pas le tag video HTML5 :-(&lt;/<span class="pl-ent" style="color: #63a35c;">p</span>&gt;   &lt;/<span class="pl-ent" style="color: #63a35c;">div</span>&gt; &lt;/<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-video</span>&gt;</pre>

&nbsp;

Vous pouvez aussi inclure une vidéo Youtube&#8230;Il faut dans ce cas inclure autre fichier Javascript (Pour des raisons évidentes de rapidité, la librairie ne prend en compte que les tags de base : img, video,..)

<pre style="overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; color: #333333; background-color: #f7f7f7;">&lt;<span class="pl-ent" style="color: #63a35c;">script</span> <span class="pl-e" style="color: #795da3;">async</span> <span class="pl-e" style="color: #795da3;">custom-element</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>amp-youtube<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">src</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>https://cdn.ampproject.org/v0/amp-youtube-0.1.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent" style="color: #63a35c;">script</span>&gt;</pre>

Considérons la vidéo suivante : <https://www.youtube.com/watch?v=DNoROPIEsGQ> (Un cadeau que j&rsquo;aimerai bien avoir à Noël :D). L&rsquo;inclure dans notre page se fait simplement :

<pre style="overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; color: #333333; background-color: #f7f7f7;">&lt;<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-youtube</span>     <span class="pl-e" style="color: #795da3;">data-videoid</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"DNoROPIEsGQ</span><span class="pl-pds">"</span></span>     <span class="pl-e" style="color: #795da3;">layout</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>responsive<span class="pl-pds">"</span></span>     <span class="pl-e" style="color: #795da3;">width</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>480<span class="pl-pds">"</span></span> <span class="pl-e" style="color: #795da3;">height</span>=<span class="pl-s" style="color: #183691;"><span class="pl-pds">"</span>270<span class="pl-pds">"</span></span>&gt; &lt;/<span class="pl-ent" style="color: #63a35c;">amp</span><span class="pl-e" style="color: #795da3;">-youtube</span>&gt;</pre>

L&rsquo;attribut _**layout**_ permet de gérer automatiquement différentes résolutions d&rsquo;écran.

&nbsp;

De nombreux <a href="https://github.com/ampproject/amphtml/blob/master/docs/include_features.md" target="_blank" rel="noopener">autres élements</a> sont gérer par le Framework : audio, tweet,&#8230;

&nbsp;

### Plus d&rsquo;informations

  * Page Github (sources, tutoriels,&#8230;) : <https://github.com/ampproject/amphtml>