---
id: 219
title: CrÃ©er son propre Find/Replace en Javascript
date: 2013-05-15T11:04:25+02:00
author: charlesen
layout: post
guid: https://charlesen.fr/?p=219
permalink: /creer-son-propre-findreplace-en-javascript/
categories:
  - tutoriel
tags:
  - cross-platform
  - find
  - firefox
  - getselection
  - javascript
  - replace
  - selection
---
<div>
  Juste parce que Ã§a fait bien de parfois rÃ©inviter la roue, je propose un code qui permet de rechercher le contenu d&rsquo;un texte Ã  l&rsquo;intÃ©rieur d&rsquo;un champ texte par exemple. J&rsquo;en ai eu besoin alors que je recherchais le moyen de modifier le contenu d&rsquo;un fichier XML depuis un champs texte sans passer par un Ã©diteur.
</div>

<div>
  Â 
</div>

<div>
  L&rsquo;idÃ©e est de disposer d&rsquo;un bouton qui en cliquant dessus ouvrirait un popup contenant deux champs textes : 1 pour le contenu Ã  recherche, l&rsquo;autre pour le texte de remplacement.
</div>

<div>
  Â 
</div>

<div>
  Voici le code finale, suffisamment clair&#8230;.Enfin j&rsquo;espÃ¨re ðŸ˜€
</div>

<div>
  Â 
</div>

<div>
  <div class="rj_insertcode">
    <div class="rj_insertcode_javascript" style="overflow: auto; width: 100%; height: auto; border: 1px solid #054b6e; background: #f8f8f8;">
      <table class="javascript" style="border-collapse: collapse; width: 100%;">
        <tr>
          <td style="background: #dddddd; color: #054b6e; padding: 2px 0px; text-align: center; font: bold italic 12px Verdana, Geneva, Arial, Helvetica, sans-serif;" colspan="2">
            Find / Replace pour les nuls
          </td>
        </tr>
        
        <tr class="li1">
          <td style="width: 1px; background: #f0f0f0; vertical-align: top; color: #676f73; border-right: 1px dotted #dddddd; font-size: 12px; text-align: right;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;">1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 </pre>
          </td>
          
          <td style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #006600; font-style: italic;">// Find & Replace</span></span> <span style="vertical-align: top;"><span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span><span style="color: #339933;">!</span>window.<span style="color: #660066;">txtFinder</span><span style="color: #009900;">)</span> txtFinder <span style="color: #339933;">=</span> <span style="color: #009900;">{</span><span style="color: #009900;">}</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">txtFinder.<span style="color: #660066;">Editor</span> <span style="color: #339933;">=</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">	selector<span style="color: #339933;">:</span> <span style="color: #3366cc;">'#xmleditingDialog'</span><span style="color: #339933;">,</span></span> <span style="vertical-align: top;">	getSelected <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">	  <span style="color: #003366; font-weight: bold;">var</span> userSelection<span style="color: #339933;">,</span> ta<span style="color: #339933;">,</span> t <span style="color: #339933;">=</span> <span style="color: #3366cc;">''</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">	  <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span>window.<span style="color: #660066;">getSelection</span> <span style="color: #339933;">&&</span> document.<span style="color: #660066;">activeElement</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span>document.<span style="color: #660066;">activeElement</span>.<span style="color: #660066;">nodeName</span> <span style="color: #339933;">==</span> <span style="color: #3366cc;">"TEXTAREA"</span> <span style="color: #339933;">||</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">(</span>document.<span style="color: #660066;">activeElement</span>.<span style="color: #660066;">nodeName</span> <span style="color: #339933;">==</span> <span style="color: #3366cc;">"INPUT"</span> <span style="color: #339933;">&&</span> document.<span style="color: #660066;">activeElement</span>.<span style="color: #660066;">getAttribute</span><span style="color: #009900;">(</span><span style="color: #3366cc;">"type"</span><span style="color: #009900;">)</span>.<span style="color: #660066;">toLowerCase</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #339933;">==</span> <span style="color: #3366cc;">"text"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">			  ta <span style="color: #339933;">=</span> document.<span style="color: #660066;">activeElement</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			  userSelection <span style="color: #339933;">=</span> ta.<span style="color: #660066;">value</span>.<span style="color: #660066;">substring</span><span style="color: #009900;">(</span>ta.<span style="color: #660066;">selectionStart</span><span style="color: #339933;">,</span> ta.<span style="color: #660066;">selectionEnd</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">				userSelection <span style="color: #339933;">=</span> window.<span style="color: #660066;">getSelection</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">			t <span style="color: #339933;">=</span> userSelection.<span style="color: #660066;">toString</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		<span style="color: #009900;">}</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span>document.<span style="color: #660066;">getSelection</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>       </span> <span style="vertical-align: top;">				<span style="color: #006600; font-style: italic;">// all browsers, except IE before version 9</span></span> <span style="vertical-align: top;">				userSelection <span style="color: #339933;">=</span> document.<span style="color: #660066;">getSelection</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">				t <span style="color: #339933;">=</span> userSelection.<span style="color: #660066;">toString</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span>document.<span style="color: #660066;">selection</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span></span> <span style="vertical-align: top;">				<span style="color: #006600; font-style: italic;">// IE below version 9</span></span> <span style="vertical-align: top;">				userSelection <span style="color: #339933;">=</span> document.<span style="color: #660066;">selection</span>.<span style="color: #660066;">createRange</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">				t <span style="color: #339933;">=</span> userSelection.<span style="color: #660066;">text</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">		<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">Â </span> <span style="vertical-align: top;">	  <span style="color: #000066; font-weight: bold;">return</span> t<span style="color: #339933;">;</span></span> <span style="vertical-align: top;">	<span style="color: #009900;">}</span><span style="color: #339933;">,</span></span> <span style="vertical-align: top;">	mouseup <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">	  <span style="color: #003366; font-weight: bold;">var</span> st <span style="color: #339933;">=</span> txtFinder.<span style="color: #660066;">Editor</span>.<span style="color: #660066;">getSelected</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">	  <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span> st <span style="color: #339933;">!=</span> <span style="color: #3366cc;">''</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">		$<span style="color: #009900;">(</span><span style="color: #3366cc;">'#findTxt'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">val</span><span style="color: #009900;">(</span>st<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">	  <span style="color: #009900;">}</span></span> <span style="vertical-align: top;">	<span style="color: #009900;">}</span><span style="color: #339933;">,</span></span> <span style="vertical-align: top;">	movetoPosition <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">(</span>textarea<span style="color: #339933;">,</span> start<span style="color: #339933;">,</span> end<span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span> parseInt<span style="color: #009900;">(</span>$.<span style="color: #660066;">browser</span>.<span style="color: #660066;">version</span><span style="color: #339933;">,</span> <span style="color: #cc0000;">10</span><span style="color: #009900;">)</span> <span style="color: #339933;">&lt;=</span><span style="color: #cc0000;">9</span> <span style="color: #339933;">&&</span> textarea.<span style="color: #660066;">createTextRange</span> <span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">			<span style="color: #006600; font-style: italic;">// IE8 and IE9</span></span> <span style="vertical-align: top;">			<span style="color: #003366; font-weight: bold;">var</span> range <span style="color: #339933;">=</span> textarea.<span style="color: #660066;">createTextRange</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			range.<span style="color: #660066;">collapse</span><span style="color: #009900;">(</span><span style="color: #003366; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			range.<span style="color: #660066;">moveEnd</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'character'</span><span style="color: #339933;">,</span> start<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			range.<span style="color: #660066;">moveStart</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'character'</span><span style="color: #339933;">,</span> end<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			range.<span style="color: #660066;">select</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		<span style="color: #009900;">}</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">			<span style="color: #006600; font-style: italic;">// Chrome, Firefox, IE10 and earlier</span></span> <span style="vertical-align: top;">			textarea.<span style="color: #000066;">focus</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			textarea.<span style="color: #660066;">setSelectionRange</span><span style="color: #009900;">(</span>start<span style="color: #339933;">,</span>end<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">	<span style="color: #009900;">}</span><span style="color: #339933;">,</span></span> <span style="vertical-align: top;">	find <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">(</span>searchTerm<span style="color: #339933;">,</span> case_sensitive<span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span> searchTerm <span style="color: #339933;">!=</span> <span style="color: #3366cc;">''</span> <span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">			txtAreaContent <span style="color: #339933;">=</span> $<span style="color: #009900;">(</span>txtFinder.<span style="color: #660066;">Editor</span>.<span style="color: #660066;">selector</span> <span style="color: #339933;">+</span> <span style="color: #3366cc;">" textarea"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			data_index <span style="color: #339933;">=</span> searchTerm <span style="color: #339933;">+</span> <span style="color: #3366cc;">'_txtFinderIndex'</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">Â </span> <span style="vertical-align: top;">			<span style="color: #006600; font-style: italic;">// Highlight founded element</span></span> <span style="vertical-align: top;">			searchIndex <span style="color: #339933;">=</span> $<span style="color: #009900;">(</span><span style="color: #3366cc;">'body'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">data</span><span style="color: #009900;">(</span>data_index<span style="color: #009900;">)</span> <span style="color: #339933;">!=</span> undefined <span style="color: #339933;">?</span> parseInt<span style="color: #009900;">(</span> $<span style="color: #009900;">(</span><span style="color: #3366cc;">'body'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">data</span><span style="color: #009900;">(</span>data_index<span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">:</span> <span style="color: #cc0000;"></span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			startIndex <span style="color: #339933;">=</span> txtAreaContent.<span style="color: #660066;">val</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #660066;">indexOf</span><span style="color: #009900;">(</span>searchTerm<span style="color: #339933;">,</span> searchIndex<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			alertMessage <span style="color: #339933;">=</span> <span style="color: #009900;">(</span> searchIndex <span style="color: #339933;">&gt;</span> <span style="color: #cc0000;"></span> <span style="color: #339933;">&&</span> startIndex <span style="color: #339933;">==</span> <span style="color: #339933;">-</span><span style="color: #cc0000;">1</span><span style="color: #009900;">)</span> <span style="color: #339933;">?</span> <span style="color: #3366cc;">'Vous avez atteint la fin du document'</span> <span style="color: #339933;">:</span> <span style="color: #3366cc;">'Non trouvÃ©'</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span> startIndex <span style="color: #339933;">&gt;</span> <span style="color: #339933;">-</span><span style="color: #cc0000;">1</span> <span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">				$<span style="color: #009900;">(</span><span style="color: #3366cc;">'#findTab'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">find</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'p.alert'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// Clear any feedback</span></span> <span style="vertical-align: top;">				endIndex <span style="color: #339933;">=</span> searchTerm.<span style="color: #660066;">length</span> <span style="color: #339933;">+</span> startIndex<span style="color: #339933;">;</span></span> <span style="vertical-align: top;">				txtFinder.<span style="color: #660066;">Editor</span>.<span style="color: #660066;">movetoPosition</span><span style="color: #009900;">(</span>document.<span style="color: #660066;">getElementById</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'xmleditingcontent'</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> startIndex<span style="color: #339933;">,</span> endIndex<span style="color: #009900;">)</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// Scroll to the element</span></span> <span style="vertical-align: top;">				txtAreaContent.<span style="color: #660066;">prop</span><span style="color: #009900;">(</span><span style="color: #3366cc;">"selectionStart"</span><span style="color: #339933;">,</span> startIndex<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">				txtAreaContent.<span style="color: #660066;">prop</span><span style="color: #009900;">(</span><span style="color: #3366cc;">"selectionEnd"</span><span style="color: #339933;">,</span> endIndex<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">				$<span style="color: #009900;">(</span><span style="color: #3366cc;">'#findTab'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">find</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'p.alert'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">remove</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #660066;">end</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span>.<span style="color: #660066;">append</span><span style="color: #009900;">(</span>$<span style="color: #009900;">(</span><span style="color: #3366cc;">'&lt;p /&gt;'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">addClass</span><span style="color: #009900;">(</span><span style="color: #3366cc;">'alert alert-info'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">text</span><span style="color: #009900;">(</span>alertMessage<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">				$<span style="color: #009900;">(</span><span style="color: #3366cc;">'body'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">removeData</span><span style="color: #009900;">(</span>data_index<span style="color: #009900;">)</span><span style="color: #339933;">;</span> <span style="color: #006600; font-style: italic;">// Re-init index for current term</span></span> <span style="vertical-align: top;">			<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">			<span style="color: #006600; font-style: italic;">// Store new index for next click (on find button)</span></span> <span style="vertical-align: top;">			$<span style="color: #009900;">(</span><span style="color: #3366cc;">'body'</span><span style="color: #009900;">)</span>.<span style="color: #660066;">data</span><span style="color: #009900;">(</span>data_index<span style="color: #339933;">,</span> startIndex <span style="color: #339933;">+</span> <span style="color: #cc0000;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> </span> <span style="vertical-align: top;">		<span style="color: #009900;">}</span></span> <span style="vertical-align: top;">	<span style="color: #009900;">}</span><span style="color: #339933;">,</span></span> <span style="vertical-align: top;">	replace <span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">(</span>searchTerm<span style="color: #339933;">,</span> replaceTerm<span style="color: #339933;">,</span> case_sensitive<span style="color: #009900;">)</span> <span style="color: #009900;">{</span></span> <span style="vertical-align: top;">		<span style="color: #003366; font-weight: bold;">var</span> txtAreaContent <span style="color: #339933;">=</span> $<span style="color: #009900;">(</span>txtFinder.<span style="color: #660066;">Editor</span>.<span style="color: #660066;">selector</span> <span style="color: #339933;">+</span> <span style="color: #3366cc;">" textarea"</span><span style="color: #009900;">)</span>.<span style="color: #660066;">val</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> modifiers <span style="color: #339933;">=</span> <span style="color: #3366cc;">'g'</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		<span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">(</span><span style="color: #339933;">!</span>case_sensitive<span style="color: #009900;">)</span> modifiers <span style="color: #339933;">+=</span><span style="color: #3366cc;">'i'</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		pattern <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">new</span> RegExp<span style="color: #009900;">(</span>searchTerm<span style="color: #339933;">,</span> modifiers<span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">		$<span style="color: #009900;">(</span>txtFinder.<span style="color: #660066;">Editor</span>.<span style="color: #660066;">selector</span> <span style="color: #339933;">+</span> <span style="color: #3366cc;">" textarea"</span><span style="color: #009900;">)</span>.<span style="color: #660066;">val</span><span style="color: #009900;">(</span> txtAreaContent.<span style="color: #660066;">replace</span><span style="color: #009900;">(</span>pattern<span style="color: #339933;">,</span> replaceTerm<span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span></span> <span style="vertical-align: top;">	<span style="color: #009900;">}</span></span> <span style="vertical-align: top;"><span style="color: #009900;">}</span></span></pre>
          </td>
        </tr>
      </table>
    </div></p>
  </div></p>
</div>